# API Design & Architectural Principles

Документ описывает стандарты разработки и структуру API для проекта `planeta_gas`. Эти принципы обязательны для соблюдения всеми агентами и разработчиками.

## 1. Именование функций (API-Style)
Все публичные функции сервисов, доступные для вызова из UI (через `google.script.run`) или внешних API, должны именоваться в стиле ресурсов (CRUD).

*   **create[Entity]** — создание объекта (напр. `createTraining`, `createSale`).
*   **get[Entity]** — получение данных (напр. `getSchedule`, `getClients`).
*   **update[Entity]** — обновление существующего объекта.
*   **delete[Entity]** — удаление объекта.

*Избегать:* `addRowToSheet`, `saveDataToBooking`.

## 2. Единый слой логирования (Observability)
Логирование централизовано в `logService.gs`. Запрещено использовать прямой `console.log` для бизнес-событий.

*   **Бизнес-логи**: Запись значимых действий пользователя (создание, удаление, изменение статуса).
*   **Технические логи**: Время выполнения скриптов, ошибки, контекст вызова.
*   **Уровни**: `INFO`, `ERROR`, `WARNING`.

## 3. Централизованная валидация
Валидация данных отделена от бизнес-логики сервисов и UI.

*   **Слой**: `BusinessValidator.gs`.
*   **Типы проверок**: 
    *   Формат данных (согласно `DATA_CONTRACTS.md`).
    *   Бизнес-конфликты (например, пересечение времени тренера).
    *   Лимиты (слоты в бассейне).
*   **Принцип**: Сервис обращается к валидатору перед выполнением любой операции записи.

## 4. Отсутствие скрытых триггеров
В системе минимизировано использование `onEdit` и других автоматических триггеров Google Таблиц.

*   Все изменения производятся через явные вызовы функций.
*   Это гарантирует предсказуемость поведения и облегчает миграцию на полноценный backend (Node.js/Go) в будущем.

## 5. Слой репозиториев (Data Access)
Прямой доступ к `SpreadsheetApp` разрешен только внутри классов репозиториев (`BaseRepository.gs` и наследники).

*   Сервисы работают только с JSON-моделями.
*   Репозитории отвечают за маппинг данных из/в строки таблиц.

---
**Последнее обновление:** 24.12.2025
**Автор:** Antigravity
